// Copyright 2025 LiveKit, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package livekit.connectors;
option go_package = "github.com/livekit/protocol/connectors";
option csharp_namespace = "LiveKit.Proto.Connectors";
option ruby_package = "LiveKit::Proto::Connectors";

import "google/protobuf/timestamp.proto";
import "connectors/whatsapp_common.proto";

message WhatsAppCallWebhook {
  string object = 1;  // Always "whatsapp_business_account"
  repeated WhatsAppWebhookEntry entry = 2;
}

message WhatsAppWebhookEntry {
  string id = 1;
  repeated WhatsAppWebhookChange changes = 3;
}

message WhatsAppWebhookChange {
  WhatsAppWebhookValue value = 1;
  string field = 2;  // "calls" for call events
}

message WhatsAppWebhookValue {
  string messaging_product = 1;  // Always "whatsapp"
  WhatsAppMetadata metadata = 2;
  repeated WhatsAppContacts contacts = 3;
  repeated WhatsAppCall calls = 4;
  repeated WhatsAppError errors = 5;
  repeated WhatsAppStatus statuses = 6;
}

message WhatsAppMetadata {
  string display_phone_number = 1;
  string phone_number_id = 2;
}

message WhatsAppContacts {
  WhatsAppProfile profile = 1;
  string wa_id = 2;
}

message WhatsAppProfile {
  string name = 1;
}

message WhatsAppError {
  uint32 code = 1;
  string message = 2;
  string href = 3;
  WhatsAppErrorData error_data = 4;
}

message WhatsAppErrorData {
  string details = 1;
}

message WhatsAppStatuses {
  string id = 1;
  google.protobuf.Timestamp timestamp = 2;
  string type = 3; // always "call"
  WhatsAppStatus status = 4;
  string recipient_id = 5;
  optional string biz_opaque_callback_data = 6;
}

enum WhatsAppStatus {
  WHATSAPP_STATUS_RINGING = 0;
  WHATSAPP_STATUS_ACCEPTED = 1;
  WHATSAPP_STATUS_REJECTED = 2;
}