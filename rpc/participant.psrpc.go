// Code generated by protoc-gen-psrpc v0.5.0, DO NOT EDIT.
// source: rpc/participant.proto

package rpc

import (
	"context"

	"github.com/livekit/psrpc"
	"github.com/livekit/psrpc/pkg/client"
	"github.com/livekit/psrpc/pkg/info"
	"github.com/livekit/psrpc/pkg/rand"
	"github.com/livekit/psrpc/pkg/server"
	"github.com/livekit/psrpc/version"
)
import livekit "github.com/livekit/protocol/livekit"
import livekit3 "github.com/livekit/protocol/livekit"

var _ = version.PsrpcVersion_0_5

// ============================
// Participant Client Interface
// ============================

type ParticipantClient[ParticipantTopicType ~string] interface {
	RemoveParticipant(ctx context.Context, participant ParticipantTopicType, req *livekit3.RoomParticipantIdentity, opts ...psrpc.RequestOption) (*livekit3.RemoveParticipantResponse, error)

	MutePublishedTrack(ctx context.Context, participant ParticipantTopicType, req *livekit3.MuteRoomTrackRequest, opts ...psrpc.RequestOption) (*livekit3.MuteRoomTrackResponse, error)

	UpdateParticipant(ctx context.Context, participant ParticipantTopicType, req *livekit3.UpdateParticipantRequest, opts ...psrpc.RequestOption) (*livekit.ParticipantInfo, error)

	UpdateSubscriptions(ctx context.Context, participant ParticipantTopicType, req *livekit3.UpdateSubscriptionsRequest, opts ...psrpc.RequestOption) (*livekit3.UpdateSubscriptionsResponse, error)
}

// ================================
// Participant ServerImpl Interface
// ================================

type ParticipantServerImpl interface {
	RemoveParticipant(context.Context, *livekit3.RoomParticipantIdentity) (*livekit3.RemoveParticipantResponse, error)

	MutePublishedTrack(context.Context, *livekit3.MuteRoomTrackRequest) (*livekit3.MuteRoomTrackResponse, error)

	UpdateParticipant(context.Context, *livekit3.UpdateParticipantRequest) (*livekit.ParticipantInfo, error)

	UpdateSubscriptions(context.Context, *livekit3.UpdateSubscriptionsRequest) (*livekit3.UpdateSubscriptionsResponse, error)
}

// ============================
// Participant Server Interface
// ============================

type ParticipantServer[ParticipantTopicType ~string] interface {
	RegisterRemoveParticipantTopic(participant ParticipantTopicType) error
	DeregisterRemoveParticipantTopic(participant ParticipantTopicType)
	RegisterMutePublishedTrackTopic(participant ParticipantTopicType) error
	DeregisterMutePublishedTrackTopic(participant ParticipantTopicType)
	RegisterUpdateParticipantTopic(participant ParticipantTopicType) error
	DeregisterUpdateParticipantTopic(participant ParticipantTopicType)
	RegisterUpdateSubscriptionsTopic(participant ParticipantTopicType) error
	DeregisterUpdateSubscriptionsTopic(participant ParticipantTopicType)
	RegisterAllParticipantTopics(participant ParticipantTopicType) error
	DeregisterAllParticipantTopics(participant ParticipantTopicType)

	// Close and wait for pending RPCs to complete
	Shutdown()

	// Close immediately, without waiting for pending RPCs
	Kill()
}

// ==================
// Participant Client
// ==================

type participantClient[ParticipantTopicType ~string] struct {
	client *client.RPCClient
}

// NewParticipantClient creates a psrpc client that implements the ParticipantClient interface.
func NewParticipantClient[ParticipantTopicType ~string](bus psrpc.MessageBus, opts ...psrpc.ClientOption) (ParticipantClient[ParticipantTopicType], error) {
	sd := &info.ServiceDefinition{
		Name: "Participant",
		ID:   rand.NewClientID(),
	}

	sd.RegisterMethod("RemoveParticipant", false, false, false, true)
	sd.RegisterMethod("MutePublishedTrack", false, false, false, true)
	sd.RegisterMethod("UpdateParticipant", false, false, false, true)
	sd.RegisterMethod("UpdateSubscriptions", false, false, false, true)

	rpcClient, err := client.NewRPCClient(sd, bus, opts...)
	if err != nil {
		return nil, err
	}

	return &participantClient[ParticipantTopicType]{
		client: rpcClient,
	}, nil
}

func (c *participantClient[ParticipantTopicType]) RemoveParticipant(ctx context.Context, participant ParticipantTopicType, req *livekit3.RoomParticipantIdentity, opts ...psrpc.RequestOption) (*livekit3.RemoveParticipantResponse, error) {
	return client.RequestSingle[*livekit3.RemoveParticipantResponse](ctx, c.client, "RemoveParticipant", []string{string(participant)}, req, opts...)
}

func (c *participantClient[ParticipantTopicType]) MutePublishedTrack(ctx context.Context, participant ParticipantTopicType, req *livekit3.MuteRoomTrackRequest, opts ...psrpc.RequestOption) (*livekit3.MuteRoomTrackResponse, error) {
	return client.RequestSingle[*livekit3.MuteRoomTrackResponse](ctx, c.client, "MutePublishedTrack", []string{string(participant)}, req, opts...)
}

func (c *participantClient[ParticipantTopicType]) UpdateParticipant(ctx context.Context, participant ParticipantTopicType, req *livekit3.UpdateParticipantRequest, opts ...psrpc.RequestOption) (*livekit.ParticipantInfo, error) {
	return client.RequestSingle[*livekit.ParticipantInfo](ctx, c.client, "UpdateParticipant", []string{string(participant)}, req, opts...)
}

func (c *participantClient[ParticipantTopicType]) UpdateSubscriptions(ctx context.Context, participant ParticipantTopicType, req *livekit3.UpdateSubscriptionsRequest, opts ...psrpc.RequestOption) (*livekit3.UpdateSubscriptionsResponse, error) {
	return client.RequestSingle[*livekit3.UpdateSubscriptionsResponse](ctx, c.client, "UpdateSubscriptions", []string{string(participant)}, req, opts...)
}

// ==================
// Participant Server
// ==================

type participantServer[ParticipantTopicType ~string] struct {
	svc ParticipantServerImpl
	rpc *server.RPCServer
}

// NewParticipantServer builds a RPCServer that will route requests
// to the corresponding method in the provided svc implementation.
func NewParticipantServer[ParticipantTopicType ~string](svc ParticipantServerImpl, bus psrpc.MessageBus, opts ...psrpc.ServerOption) (ParticipantServer[ParticipantTopicType], error) {
	sd := &info.ServiceDefinition{
		Name: "Participant",
		ID:   rand.NewServerID(),
	}

	s := server.NewRPCServer(sd, bus, opts...)

	sd.RegisterMethod("RemoveParticipant", false, false, false, true)
	sd.RegisterMethod("MutePublishedTrack", false, false, false, true)
	sd.RegisterMethod("UpdateParticipant", false, false, false, true)
	sd.RegisterMethod("UpdateSubscriptions", false, false, false, true)
	return &participantServer[ParticipantTopicType]{
		svc: svc,
		rpc: s,
	}, nil
}

func (s *participantServer[ParticipantTopicType]) RegisterRemoveParticipantTopic(participant ParticipantTopicType) error {
	return server.RegisterHandler(s.rpc, "RemoveParticipant", []string{string(participant)}, s.svc.RemoveParticipant, nil)
}

func (s *participantServer[ParticipantTopicType]) DeregisterRemoveParticipantTopic(participant ParticipantTopicType) {
	s.rpc.DeregisterHandler("RemoveParticipant", []string{string(participant)})
}

func (s *participantServer[ParticipantTopicType]) RegisterMutePublishedTrackTopic(participant ParticipantTopicType) error {
	return server.RegisterHandler(s.rpc, "MutePublishedTrack", []string{string(participant)}, s.svc.MutePublishedTrack, nil)
}

func (s *participantServer[ParticipantTopicType]) DeregisterMutePublishedTrackTopic(participant ParticipantTopicType) {
	s.rpc.DeregisterHandler("MutePublishedTrack", []string{string(participant)})
}

func (s *participantServer[ParticipantTopicType]) RegisterUpdateParticipantTopic(participant ParticipantTopicType) error {
	return server.RegisterHandler(s.rpc, "UpdateParticipant", []string{string(participant)}, s.svc.UpdateParticipant, nil)
}

func (s *participantServer[ParticipantTopicType]) DeregisterUpdateParticipantTopic(participant ParticipantTopicType) {
	s.rpc.DeregisterHandler("UpdateParticipant", []string{string(participant)})
}

func (s *participantServer[ParticipantTopicType]) RegisterUpdateSubscriptionsTopic(participant ParticipantTopicType) error {
	return server.RegisterHandler(s.rpc, "UpdateSubscriptions", []string{string(participant)}, s.svc.UpdateSubscriptions, nil)
}

func (s *participantServer[ParticipantTopicType]) DeregisterUpdateSubscriptionsTopic(participant ParticipantTopicType) {
	s.rpc.DeregisterHandler("UpdateSubscriptions", []string{string(participant)})
}

func (s *participantServer[ParticipantTopicType]) allParticipantTopicRegisterers() server.RegistererSlice {
	return server.RegistererSlice{
		server.NewRegisterer(s.RegisterRemoveParticipantTopic, s.DeregisterRemoveParticipantTopic),
		server.NewRegisterer(s.RegisterMutePublishedTrackTopic, s.DeregisterMutePublishedTrackTopic),
		server.NewRegisterer(s.RegisterUpdateParticipantTopic, s.DeregisterUpdateParticipantTopic),
		server.NewRegisterer(s.RegisterUpdateSubscriptionsTopic, s.DeregisterUpdateSubscriptionsTopic),
	}
}

func (s *participantServer[ParticipantTopicType]) RegisterAllParticipantTopics(participant ParticipantTopicType) error {
	return s.allParticipantTopicRegisterers().Register(participant)
}

func (s *participantServer[ParticipantTopicType]) DeregisterAllParticipantTopics(participant ParticipantTopicType) {
	s.allParticipantTopicRegisterers().Deregister(participant)
}

func (s *participantServer[ParticipantTopicType]) Shutdown() {
	s.rpc.Close(false)
}

func (s *participantServer[ParticipantTopicType]) Kill() {
	s.rpc.Close(true)
}

var psrpcFileDescriptor4 = []byte{
	// 303 bytes of a gzipped FileDescriptorProto
	0x1f, 0x8b, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0xff, 0x94, 0x92, 0xcf, 0x4a, 0xc3, 0x40,
	0x10, 0xc6, 0x59, 0x14, 0x0f, 0x5b, 0x04, 0xbb, 0x2a, 0x94, 0x80, 0xa5, 0x56, 0xf1, 0x20, 0x92,
	0x80, 0xbe, 0x81, 0x37, 0x0f, 0x42, 0x89, 0x7a, 0xf1, 0x22, 0xc9, 0x66, 0x6c, 0x97, 0xfc, 0x99,
	0x75, 0x77, 0x12, 0x14, 0x4f, 0xde, 0xf4, 0xec, 0x9b, 0xf8, 0x84, 0xd2, 0xa6, 0x49, 0xb7, 0x15,
	0xc5, 0x9e, 0x42, 0xbe, 0x6f, 0xe6, 0xfb, 0xed, 0xcc, 0x2e, 0xdf, 0x37, 0x5a, 0x06, 0x3a, 0x32,
	0xa4, 0xa4, 0xd2, 0x51, 0x41, 0xbe, 0x36, 0x48, 0x28, 0x36, 0x8c, 0x96, 0xde, 0x36, 0x6a, 0x52,
	0x58, 0xd8, 0x5a, 0xf3, 0xf6, 0x32, 0x55, 0x41, 0xaa, 0xe8, 0x21, 0xc7, 0x04, 0xb2, 0x46, 0x15,
	0x8d, 0x6a, 0x10, 0xf3, 0x5a, 0x3b, 0xff, 0xdc, 0xe4, 0x9d, 0xd1, 0x22, 0x53, 0xbc, 0x31, 0xde,
	0x0d, 0x21, 0xc7, 0x0a, 0x5c, 0x75, 0xe0, 0xcf, 0x5b, 0xfd, 0x10, 0x31, 0x77, 0x9c, 0xab, 0x04,
	0x0a, 0x52, 0xf4, 0xe2, 0x0d, 0x17, 0x15, 0xab, 0xdd, 0x21, 0x58, 0x8d, 0x85, 0x85, 0xe1, 0xc9,
	0xd7, 0x07, 0x1b, 0xee, 0x30, 0xaf, 0xcf, 0x3b, 0xce, 0x18, 0xc2, 0xfd, 0xe9, 0xb1, 0x01, 0x13,
	0xaf, 0x5c, 0x5c, 0x97, 0x04, 0xa3, 0x32, 0xce, 0x94, 0x9d, 0x40, 0x72, 0x6b, 0x22, 0x99, 0x8a,
	0x83, 0x96, 0x30, 0x35, 0xa7, 0xe7, 0x98, 0xe9, 0x21, 0x3c, 0x95, 0x60, 0xc9, 0xeb, 0xff, 0x66,
	0xaf, 0x09, 0x7f, 0xe6, 0xdd, 0x3b, 0x9d, 0x44, 0xb4, 0x34, 0xff, 0x61, 0x1b, 0xfe, 0xc3, 0x6b,
	0xf8, 0xbd, 0xb6, 0xc4, 0x5d, 0x4f, 0xf1, 0x88, 0xff, 0x26, 0xbf, 0x33, 0xbe, 0x5b, 0xc7, 0xdf,
	0x94, 0xb1, 0x95, 0x46, 0xd5, 0x57, 0x2a, 0x8e, 0x56, 0xe0, 0x4b, 0x6e, 0x83, 0x3f, 0xfe, 0xbb,
	0x68, 0xbd, 0x25, 0x5c, 0x9e, 0xdd, 0x9f, 0x8e, 0x15, 0x4d, 0xca, 0xd8, 0x97, 0x98, 0x07, 0xf3,
	0xe4, 0xf6, 0xab, 0xd3, 0x71, 0x60, 0xc1, 0x54, 0x4a, 0x42, 0x60, 0xb4, 0x8c, 0xb7, 0x66, 0x4f,
	0xe9, 0xe2, 0x3b, 0x00, 0x00, 0xff, 0xff, 0x83, 0x21, 0xcd, 0xfd, 0xa1, 0x02, 0x00, 0x00,
}
